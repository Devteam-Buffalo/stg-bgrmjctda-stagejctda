<?php
/**
 * Project Name:    Discover Jackson NC
 * Project URI:     https://www.discoverjacksonnc.com
 * Description:     Custom shortcodes to use inside the WYSIWYG, rendered on the front-end.
 * Agency:          Rawle Murdy Associates
 * Agency URI:      https://www.rawlemurdy.com
 * Text Domain:     jctda
 *
 * @package         jctda
 * @since           3.3.0
 * @link            https://www.discoverjacksonnc.com
 * @author          lpeterson
 * @date            6/15/18
 * @file            add-shortcode.php
 */
defined('ABSPATH') or exit;

add_shortcode( 'iframe', function( $atts ) {
	$defaults = [
		'src' => 'http://www.youtube.com/embed/4qsGTXLnmKs',
		'width' => '100%',
		'height' => '500',
		'scrolling' => 'yes',
		'class' => 'iframe-class',
		'frameborder' => '0'
	];

	foreach ( $defaults as $default => $value ) { // add defaults
		if ( ! @array_key_exists( $default, $atts ) ) { // mute warning with "@" when no params at all
			$atts[$default] = $value;
		}
	}

	$html = '<iframe';
	foreach( $atts as $attr => $value ) {
		if ( strtolower($attr) != 'same_height_as' && strtolower($attr) != 'onload'
			AND strtolower($attr) != 'onpageshow' && strtolower($attr) != 'onclick') { // remove some attributes
			if ( $value != '' ) { // adding all attributes
				$html .= ' ' . esc_attr( $attr ) . '="' . esc_attr( $value ) . '"';
			} else { // adding empty attributes
				$html .= ' ' . esc_attr( $attr );
			}
		}
	}
	$html .= '></iframe>'."\n";

	if ( isset( $atts["same_height_as"] ) ) {
		$html .= '
			<script>
			document.addEventListener("DOMContentLoaded", function(){
				var target_element, iframe_element;
				iframe_element = document.querySelector("iframe.' . esc_attr( $atts["class"] ) . '");
				target_element = document.querySelector("' . esc_attr( $atts["same_height_as"] ) . '");
				iframe_element.style.height = target_element.offsetHeight + "px";
			});
			</script>
		';
	}

	return $html;
});

/*
[compare
element="button" (required) (string) Default: a
exclude="" (optional) (string|integer|array) Exclude page(s) the "event" should show within the string; Examples: exclude="1328"; exclude="fares-passes"; exclude="Fares & Passes"; exclude="array(1328,1330)"
href="" (optional) (string) Enter URL as fallback when element is "a" and when specifying exclude (if on excluded page, enter alternate URL destination so button is dead)
id="" (optional) (string) Enter a CSS ID for this toggle
class="" (optional) (string) Enter one or more CSS classes for this toggle
title="" (optional) (string) Enter title attribute text for this toggle
rel="noopener" (optional) (string) Default: noopener
target="" (required) (string) Enter the target item to toggle
mode="click" (optional) (string) Default: click | click, hover or both
cls="" (optional) (string) Enter a class to toggle | Example: .toggle-class
animation="" (optional) (string) Animate the element being toggled
duration="200" (optional) (integer) Default: 200 | Toggle animation duration
queued="true" (optional) (boolean) Default: true | Queue the toggle animations
text="" (optional) (string) Enter text to display inside the toggle button element
event="uk-toggle" (required) (string) Default: uk-toggle | Typically "toggle" although other options possible
]
------------------------------------ */
add_shortcode( 'compare', function( $atts ) {
	$a = shortcode_atts( [
		'id'     => '',
		'before' => '',
		'after'  => '',
		], $atts );

	if( ! $a['before'] && ! $a['after'] )
		return 'Please provide URLs for 2 images: before and after.';

	$before = $a['before'] ? esc_url_raw( $a['before'], [ 'https' ] ) : false;
	$after  = $a['after'] ? esc_url_raw( $a['after'], [ 'https' ] ) : false;
	$sc_id  = $a['id'] ? esc_attr( $a['id'] ) : 'compare-' . random_int( 1000, 100000 );

	$compare = '<div class="ba-slider">'.
		'<div id="'.$sc_id.'" class="compare">'.
			'<img src="'.$after.'">'.

			'<div class="resize">'.
				'<img src="'.$before.'">'.
			'</div>'.

			'<div class="handle"></div>'.
		'</div>'.
	'</div>';

	wp_enqueue_style( 'compare/css', ASSETS . '/css/before-after.min.css', false, null, 'all' );
	wp_enqueue_script( 'compare/js', ASSETS . '/js/before-after.min.js', [ 'jquery' ], null, true );
	wp_add_inline_script( 'compare/js', 'jQuery("#'.$sc_id.'").beforeAfter();', 'after' );

	return $compare;
});

add_shortcode( 'blog_tiles', function() {
$args = [
	'post_type'              => ['post'],
	'post_status'            => ['publish'],
	'posts_per_page'         => 3,
	'order'                  => 'DESC',
	'orderby'                => 'date',
	'no_found_rows'          => true,
	'cache_results'          => true,
	'update_post_meta_cache' => false,
	'update_post_term_cache' => false,
];
$posts = new WP_Query( $args );
ob_start();
?>

<div class="uk-slidenav-position" data-uk-slider>
	<div class="uk-slider-container">
		<div class="uk-slider uk-grid uk-grid-width-large-1-3 uk-grid-width-medium-1-2 uk-grid-width-1-1" data-uk-grid-match>
			<?php while ( $posts->have_posts() ) : $posts->the_post(); ?>
			<div class="blog-tiles">
				<figure class="uk-overlay uk-overlay-background trans-blue" style="background:url(<?= wpthumb( wp_get_attachment_image_url( get_post_thumbnail_id( get_the_id() ), 'full', false ), ['width'=>525,'height'=>525,'resize'=>true,'crop'=>true] ) ?>) center center no-repeat;background-size:cover">
					<canvas width="525" height="525" tabindex="-1"></canvas>

					<div class="uk-overlay-panel uk-flex uk-flex-center uk-flex-middle uk-text-center">
						<figcaption>
							<img src="<?= ASSETS . '/img/latest-blog-icon.png'; ?>" width="38" class="uk-display-block uk-align-center">
							<label><time class="uk-text-uppercase sans-bold" datetime="<?= get_the_date( 'c', get_the_id() ) ?>" itemprop="datePublished"><?= get_the_date( get_option( 'date_format', 'd.m.Y' ), get_the_id() ) ?></time></label>
							<h3 class="sans-thin"><?= get_the_title() ?></h3>
							<button class="uk-button uk-button-warning uk-button-large">Read More</button>
						</figcaption>
					</div>

					<a class="uk-position-cover" href="<?= get_the_permalink() ?>" title="<?php the_title_attribute() ?>"></a>
				</figure>
			</div>
			<?php endwhile; wp_reset_query(); ?>
		</div>
	</div>

	<a href="" class="uk-slidenav uk-slidenav-contrast uk-slidenav-previous uk-hidden-large" data-uk-slider-item="previous"></a>
	<a href="" class="uk-slidenav uk-slidenav-contrast uk-slidenav-next uk-hidden-large" data-uk-slider-item="next"></a>
</div>

<?php
$blog = ob_get_clean();
return $blog;
	// return get_template_part( 'resource/view/layout/content/blog', 'tiles' );
});
