<?php
/**
 * Project Name:    Discover Jackson NC
 * Project URI:     https://www.discoverjacksonnc.com
 * Description:     Filters the path of the current template before including it
 * Agency:          Rawle Murdy Associates
 * Agency URI:      https://www.rawlemurdy.com
 * Text Domain:     jctda
 *
 * @package         jctda
 * @since           20181211
 * @author          lpeterson
 *
 * @param string $template The path of the template to include.
 */

add_filter( 'template_include', function( $template ) {
	if ( !is_main_query() || is_admin() )
		return $template;

	$object = get_queried_object();

	$singulars = [
		// 'outdoor',
		// 'attraction',
		// 'town',
		// 'wedding',
		// 'press_release',
		// 'b2b_news',
		// 'tda_docs',
		// 'mentions',
		'jc_food_drink',
		'jc_lodging',
		// 'jc_trip_idea',
		// 'jc_visitor_gallery',
	];

	if ( isset( $object->ID ) && metadata_exists( 'post', $object->ID, '_wp_page_template' ) )
		$_wp_page_template = get_metadata( 'post', $object->ID, '_wp_page_template', true );

	if ( is_singular( $singulars ) ) {
		if ( isset( $object->post_type, $_wp_page_template ) && !empty( $_wp_page_template ) && $_wp_page_template !== 'default' )
			return get_theme_file_path( $_wp_page_template );
		else
			return get_theme_file_path( 'resource/view/layout/single/'.$object->post_type.'.php' );
	}

	// if ( is_post_type_archive( ['jc_trip_idea'] ) )
		// return get_theme_file_path( 'resource/view/layout/archive/jc_trip_idea.php' );

	// if ( is_post_type_archive( ['jc_visitor_gallery'] ) )
		// return get_theme_file_path( 'resource/view/layout/archive/jc_visitor_gallery.php' );

	// if ( is_post_type_archive( ['outdoor', 'attraction'] ) )
		// return get_theme_file_path( 'resource/view/layout/archive/map-masonry.php' );

	return $template;
});
