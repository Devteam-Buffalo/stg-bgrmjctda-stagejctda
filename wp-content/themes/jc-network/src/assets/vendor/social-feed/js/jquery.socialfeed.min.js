"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),function(a,b,c,d){a.fn.socialfeed=function(b){function k(){h.forEach(function(a){e[a]&&(i+=e[a].accounts?e[a].limit*e[a].accounts.length:e[a].limit)})}function l(){var a=!0;a&&e.callback&&e.callback()}function n(a,b){this.content=b,this.content.social_network=a,this.content.attachment=this.content.attachment===d?"":this.content.attachment,this.content.time_ago=b.dt_create.fromNow(),this.content.date=b.dt_create.format(e.date_format),this.content.dt_create=this.content.dt_create.valueOf(),this.content.text=m.wrapLinks(m.shorten(b.message+" "+b.description),b.social_network),this.content.moderation_passed=!e.moderation||e.moderation(this.content),o[a].posts.push(this)}var c={plugin_folder:"",template:"template.html",show_media:!1,media_min_width:300,length:500,date_format:"ll"},e=a.extend(c,b),f=a(this),h=["facebook","instagram","vk","google","blogspot","twitter","pinterest","rss"],i=0,j=0;k();var m={request:function(b,c){a.ajax({url:b,dataType:"jsonp",success:c})},get_request:function(b,c){a.get(b,c,"json")},wrapLinks:function(a,b){var c=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return a="google-plus"===b?a.replace(/(@|#)([a-z0-9_]+['])/gi,m.wrapGoogleplusTagTemplate):a.replace(c,m.wrapLinkTemplate)},wrapLinkTemplate:function(a){return'<a target="_blank" href="'+a+'">'+a+"</a>"},wrapGoogleplusTagTemplate:function(a){return'<a target="_blank" href="https://plus.google.com/s/'+a+'" >'+a+"</a>"},shorten:function(b){return b=a.trim(b),b.length>e.length?jQuery.trim(b).substring(0,e.length).split(" ").slice(0,-1).join(" ")+"...":b},stripHTML:function(a){return"undefined"==typeof a||null===a?"":a.replace(/(<([^>]+)>)|nbsp;|\s{2,}|/gi,"")}};n.prototype={render:function(){var b=o.template(this.content),c=this.content;if(0!==a(f).children("[social-feed-id="+c.id+"]").length)return!1;if(0===a(f).children().length)a(f).append(b);else{var d=0,g=-1;if(a.each(a(f).children(),function(){return a(this).attr("dt-create")<c.dt_create?(g=d,!1):void d++}),a(f).append(b),g>=0){g++;var h=a(f).children("div:nth-child("+g+")"),k=a(f).children("div:last-child");a(k).insertBefore(h)}}if(e.media_min_width){var m="[social-feed-id="+c.id+"] img.attachment",n=a(m),r=new Image,s=n.attr("src");a(r).load(function(){r.width<e.media_min_width&&n.hide(),delete r}).error(function(){n.hide()}).attr({src:s})}j++,j==i&&l()}};var o={template:!1,init:function(){o.getTemplate(function(){h.forEach(function(a){e[a]&&(e[a].accounts?e[a].accounts.forEach(function(b){o[a].getData(b)}):e[a].urls?e[a].urls.forEach(function(b){o[a].getData(b)}):o[a].getData())})})},getTemplate:function(b){return o.template?b():e.template_html?(o.template=doT.template(e.template_html),b()):void a.get(e.template,function(a){return o.template=doT.template(a),b()})},twitter:{posts:[],loaded:!1,api:"http://api.tweecool.com/",getData:function(a){var b=new Codebird;switch(b.setConsumerKey(e.twitter.consumer_key,e.twitter.consumer_secret),e.twitter.proxy!==d&&b.setProxy(e.twitter.proxy),a[0]){case"@":var c=a.substr(1);b.__call("statuses_userTimeline","id="+c+"&count="+e.twitter.limit,o.twitter.utility.getPosts,!0);break;case"#":var f=a.substr(1);b.__call("search_tweets","q="+f+"&count="+e.twitter.limit,function(a){o.twitter.utility.getPosts(a.statuses)},!0)}},utility:{getPosts:function(b){b&&a.each(b,function(){var a=this,b=new n("twitter",o.twitter.utility.unifyPostData(a));b.render()})},unifyPostData:function(a){var b={};if(a.id&&(b.id=a.id,b.dt_create=moment(new Date(a.created_at)),b.author_link="http://twitter.com/"+a.user.screen_name,b.author_picture=a.user.profile_image_url,b.post_url=b.author_link+"/status/"+a.id_str,b.author_name=a.user.name,b.message=a.text,b.description="",b.link="http://twitter.com/"+a.user.screen_name+"/status/"+a.id_str,e.show_media===!0&&a.entities.media&&a.entities.media.length>0)){var c=a.entities.media[0].media_url;c&&(b.attachment='<img class="attachment" src="'+c+'" />')}return b}}},facebook:{posts:[],graph:"https://graph.facebook.com/",loaded:!1,getData:function(a){var b=function(a){m.request(a,o.facebook.utility.getPosts)},c="?fields=id,from,name,message,created_time,story,description,link";c+=e.show_media===!0?",picture,object_id":"";var d,f="&limit="+e.facebook.limit,g="&access_token="+e.facebook.access_token+"&callback=?";switch(a[0]){case"@":var h=a.substr(1);o.facebook.utility.getUserId(h,function(a){""!==a.id&&(d=o.facebook.graph+"v2.4/"+a.id+"/posts"+c+f+g,b(d))});break;case"!":var i=a.substr(1);d=o.facebook.graph+"v2.4/"+i+"/feed"+c+f+g,b(d);break;default:b(d)}},utility:{getUserId:function(b,c){var d="&access_token="+e.facebook.access_token+"&callback=?",f="https://graph.facebook.com/"+b+"?"+d;a.get(f,c,"json")},prepareAttachment:function(a){var b=a.picture;return b.indexOf("_b.")!==-1||(b.indexOf("safe_image.php")!==-1?b=o.facebook.utility.getExternalImageURL(b,"url"):b.indexOf("app_full_proxy.php")!==-1?b=o.facebook.utility.getExternalImageURL(b,"src"):a.object_id&&(b=o.facebook.graph+a.object_id+"/picture/?type=normal")),'<img class="attachment" src="'+b+'" />'},getExternalImageURL:function(a,b){return a=decodeURIComponent(a).split(b+"=")[1],a.indexOf("fbcdn-sphotos")===-1?a.split("&")[0]:a},getPosts:function(a){a.data&&a.data.forEach(function(a){var b=new n("facebook",o.facebook.utility.unifyPostData(a));b.render()})},unifyPostData:function(a){var b={},c=a.message?a.message:a.story;if(b.id=a.id,b.dt_create=moment(a.created_time),b.author_link="http://facebook.com/"+a.from.id,b.author_picture=o.facebook.graph+a.from.id+"/picture",b.author_name=a.from.name,b.name=a.name||"",b.message=c?c:"",b.description=a.description?a.description:"",b.link=a.link?a.link:"http://facebook.com/"+a.from.id,e.show_media===!0&&a.picture){var d=o.facebook.utility.prepareAttachment(a);d&&(b.attachment=d)}return b}}},google:{posts:[],loaded:!1,api:"https://www.googleapis.com/plus/v1/",getData:function(a){var b;switch(a[0]){case"#":var c=a.substr(1);b=o.google.api+"activities?query="+c+"&key="+e.google.access_token+"&maxResults="+e.google.limit,m.get_request(b,o.google.utility.getPosts);break;case"@":var d=a.substr(1);b=o.google.api+"people/"+d+"/activities/public?key="+e.google.access_token+"&maxResults="+e.google.limit,m.get_request(b,o.google.utility.getPosts)}},utility:{getPosts:function(b){b.items&&a.each(b.items,function(a){var c=new n("google",o.google.utility.unifyPostData(b.items[a]));c.render()})},unifyPostData:function(b){var c={};return c.id=b.id,c.attachment="",c.description="",c.dt_create=moment(b.published),c.author_link=b.actor.url,c.author_picture=b.actor.image.url,c.author_name=b.actor.displayName,e.show_media===!0&&b.object.attachments&&a.each(b.object.attachments,function(){var a="";this.fullImage?a=this.fullImage.url:"album"===this.objectType&&this.thumbnails&&this.thumbnails.length>0&&this.thumbnails[0].image&&(a=this.thumbnails[0].image.url),c.attachment='<img class="attachment" src="'+a+'"/>'}),c.message=b.title,c.link=b.url,c}}},instagram:{posts:[],api:"https://api.instagram.com/v1/",loaded:!1,accessType:function(){return"undefined"==typeof e.instagram.access_token&&"undefined"==typeof e.instagram.client_id?(console.log("You need to define a client_id or access_token to authenticate with Instagram's API."),d):(e.instagram.access_token&&(e.instagram.client_id=d),e.instagram.access_type="undefined"==typeof e.instagram.client_id?"access_token":"client_id",e.instagram.access_type)},getData:function(a){var b;if("undefined"!==this.accessType())var c=e.instagram.access_type+"="+e.instagram[e.instagram.access_type];switch(a[0]){case"@":var d=a.substr(1);b=o.instagram.api+"users/search/?q="+d+"&"+c+"&count=1&callback=?",m.request(b,o.instagram.utility.getUsers);break;case"#":var f=a.substr(1);b=o.instagram.api+"tags/"+f+"/media/recent/?"+c+"&count="+e.instagram.limit+"&callback=?",m.request(b,o.instagram.utility.getImages);break;case"&":var g=a.substr(1);b=o.instagram.api+"users/"+g+"/?"+c+"&count="+e.instagram.limit+"&callback=?",m.request(b,o.instagram.utility.getUsers)}},utility:{getImages:function(a){a.data&&a.data.forEach(function(a){var b=new n("instagram",o.instagram.utility.unifyPostData(a));b.render()})},getUsers:function(a){if("undefined"!==e.instagram.access_type)var b=e.instagram.access_type+"="+e.instagram[e.instagram.access_type];jQuery.isArray(a.data)||(a.data=[a.data]),a.data.forEach(function(a){var c=o.instagram.api+"users/"+a.id+"/media/recent/?"+b+"&count="+e.instagram.limit+"&callback=?";m.request(c,o.instagram.utility.getImages)})},unifyPostData:function(a){var b={};return b.id=a.id,b.dt_create=moment(1e3*a.created_time),b.author_link="http://instagram.com/"+a.user.username,b.author_picture=a.user.profile_picture,b.author_name=a.user.full_name||a.user.username,b.message=a.caption&&a.caption?a.caption.text:"",b.description="",b.link=a.link,e.show_media&&(b.attachment='<img class="attachment" src="'+a.images.standard_resolution.url+'" />'),b}}},vk:{posts:[],loaded:!1,base:"http://vk.com/",api:"https://api.vk.com/method/",user_json_template:"https://api.vk.com/method/users.get?fields=first_name,%20last_name,%20screen_name,%20photo&uid=",group_json_template:"https://api.vk.com/method/groups.getById?fields=first_name,%20last_name,%20screen_name,%20photo&gid=",getData:function(a){var b;switch(a[0]){case"@":var c=a.substr(1);b=o.vk.api+"wall.get?owner_id="+c+"&filter="+e.vk.source+"&count="+e.vk.limit+"&callback=?",m.get_request(b,o.vk.utility.getPosts);break;case"#":var d=a.substr(1);b=o.vk.api+"newsfeed.search?q="+d+"&count="+e.vk.limit+"&callback=?",m.get_request(b,o.vk.utility.getPosts)}},utility:{getPosts:function(b){b.response&&a.each(b.response,function(){if(this!=parseInt(this)&&"post"===this.post_type){var a=this.owner_id?this.owner_id:this.from_id,c=a>0?o.vk.user_json_template+a+"&callback=?":o.vk.group_json_template+-1*a+"&callback=?",d=this;m.get_request(c,function(a){o.vk.utility.unifyPostData(a,d,b)})}})},unifyPostData:function(a,b,c){var d={};if(d.id=b.id,d.dt_create=moment.unix(b.date),d.description=" ",d.message=m.stripHTML(b.text),e.show_media&&b.attachment&&("link"===b.attachment.type&&(d.attachment='<img class="attachment" src="'+b.attachment.link.image_src+'" />'),"video"===b.attachment.type&&(d.attachment='<img class="attachment" src="'+b.attachment.video.image_big+'" />'),"photo"===b.attachment.type&&(d.attachment='<img class="attachment" src="'+b.attachment.photo.src_big+'" />')),b.from_id>0){var f=o.vk.user_json_template+b.from_id+"&callback=?";m.get_request(f,function(a){var e=new n("vk",o.vk.utility.getUser(a,d,b,c));e.render()})}else{var g=o.vk.group_json_template+-1*b.from_id+"&callback=?";m.get_request(g,function(a){var e=new n("vk",o.vk.utility.getGroup(a,d,b,c));e.render()})}},getUser:function(a,b,c,d){return b.author_name=a.response[0].first_name+" "+a.response[0].last_name,b.author_picture=a.response[0].photo,b.author_link=o.vk.base+a.response[0].screen_name,b.link=o.vk.base+a.response[0].screen_name+"?w=wall"+c.from_id+"_"+c.id,b},getGroup:function(a,b,c,d){return b.author_name=a.response[0].name,b.author_picture=a.response[0].photo,b.author_link=o.vk.base+a.response[0].screen_name,b.link=o.vk.base+a.response[0].screen_name+"?w=wall-"+a.response[0].gid+"_"+c.id,b}}},blogspot:{loaded:!1,getData:function(a){var b;switch(a[0]){case"@":var c=a.substr(1);b="http://"+c+".blogspot.com/feeds/posts/default?alt=json-in-script&callback=?",request(b,getPosts)}},utility:{getPosts:function(b){a.each(b.feed.entry,function(){var a={},b=this;a.id=b.id.$t.replace(/[^a-z0-9]/gi,""),a.dt_create=moment(b.published.$t),a.author_link=b.author[0].uri.$t,a.author_picture="http:"+b.author[0].gd$image.src,a.author_name=b.author[0].name.$t,a.message=b.title.$t+"</br></br>"+stripHTML(b.content.$t),a.description="",a.link=b.link.pop().href,e.show_media&&b.media$thumbnail&&(a.attachment='<img class="attachment" src="'+b.media$thumbnail.url+'" />'),a.render()})}}},pinterest:{posts:[],loaded:!1,apiv1:"https://api.pinterest.com/v1/",getData:function(a){var b,c="limit="+e.pinterest.limit,d="fields=id,created_at,link,note,creator(url,first_name,last_name,image),image",f=d+"&access_token="+e.pinterest.access_token+"&"+c+"&callback=?";switch(a[0]){case"@":var g=a.substr(1);b="me"===g?o.pinterest.apiv1+"me/pins/?"+f:o.pinterest.apiv1+"boards/"+g+"/pins?"+f}m.request(b,o.pinterest.utility.getPosts)},utility:{getPosts:function(a){a.data.forEach(function(a){var b=new n("pinterest",o.pinterest.utility.unifyPostData(a));b.render()})},unifyPostData:function(a){var b={};return b.id=a.id,b.dt_create=moment(a.created_at),b.author_link=a.creator.url,b.author_picture=a.creator.image["60x60"].url,b.author_name=a.creator.first_name+a.creator.last_name,b.message=a.note,b.description="",b.social_network="pinterest",b.link=a.link?a.link:"https://www.pinterest.com/pin/"+a.id,e.show_media&&(b.attachment='<img class="attachment" src="'+a.image.original.url+'" />'),b}}},rss:{posts:[],loaded:!1,api:"https://ajax.googleapis.com/ajax/services/feed/load?v=1.0",getData:function(a){var b="&num="+e.rss.limit,c=o.rss.api+b+"&q="+encodeURIComponent(a);m.request(c,o.rss.utility.getPosts)},utility:{getPosts:function(b){a.each(b.responseData.feed.entries,function(a,b){var c=new n("rss",o.rss.utility.unifyPostData(a,b));c.render()})},unifyPostData:function(a,b){var c={};return c.id=a,c.dt_create=moment(b.publishedDate,"ddd, DD MMM YYYY HH:mm:ss ZZ","en"),c.author_link="",c.author_picture="",c.author_name=b.author,c.message=m.stripHTML(b.title),c.description=m.stripHTML(b.content),c.social_network="rss",c.link=b.link,e.show_media&&b.mediaGroups&&(c.attachment='<img class="attachment" src="'+b.mediaGroups[0].contents[0].url+'" />'),c}}}};return this.each(function(){o.init()})}}(jQuery);